# 数据库原理与应用课程学习记录

**个人信息：张闻珈  2022级数字经济  42238038**

```
以下内容是我本学期以来进行数据库课程学习的一些记录总结与学习体会。
```

---

**引言：**
作为一名非计算机专业的大三学生，在过去的五学期里我也仅仅接触了两三门非常基础的计算机实践课程。或许是对计算机学科的理解能力和产出能力比较差吧，自己好像一直是“计算机小白”的角色，大抵有些愧对本专业“数字经济”的“数字”二字。因此，从一开始选择这门专业方向课，其实就是想趁着大四毕业之前，学一点更体现“数字”的知识与技能。而且更现实的是，在如今与日低迷的求职市场中绝大多数招聘岗位里，掌握一定的计算机实操能力的人，似乎才会更有话语权。因此，在这门课程的学习过程中，我从一开始甚至不会通过科/学上网打开Github而多方求助，到能自己配置运行SQL、DataGrip等来保质保量完成每次作业，了解数据库背后层层的知识体系，好像曾经看起来令人“望而生畏”摸不着头脑的数据库此刻已然为我敞开它的大门。

---

##**第一周（2月27日）：课程导入与数据库初探**
**学习内容：**
1.**什么是数据库、DBMS**？
2.**为什么我们要学习使用数据库**（数据库的应用）？
3.**数据库系统的应用**（如果没有DBMS，文件处理系统面临的缺点）。
4.**数据视图、数据抽象、数据模型**。
5.**DDL和DML**。

**课后实践：**
- **下载并安装PostgreSQL和DataGrip**。
这个过程中遇到了好多麻烦，印象里我当时下载其中一个软件的时候一直显示下载失败，最后查了好久的教程发现是因为我的电脑用户名是中文，导致路径里有汉字所以下载不了，而我学了好久也没学会怎么把这个中文名改成英文，当时觉得天都塌了。还好后来灵光一现，索性学着给电脑添加了一个新的用户，整了个英文名，才成功把两个软件下好。当时特别庆幸自己在第一节实验课之前完成了这两个软件的安装和调试，不然不敢想象到课堂上我得手忙脚乱成什么样。

---

##**第二周（3月6日）：关系模型 (Relational Model)**
**学习内容：**
1. **关系数据库的基本概念**：关系（表）、元组（行）、属性（列）。
2. **码（Key）的类型**：超码、候选码、主码、外码。
3. **关系代数**：选择（σ）、投影（Π）、笛卡尔积（×）、连接（⋈）、并（∪）、交（∩）、差（−）。
4. **关系模式与实例**：数据库模式的实例应用。

**学习收获：**
- 理解了关系数据库的基本结构和核心概念。
- 掌握了如何通过主码和外码维护数据完整性。
- 学会了使用关系代数表达简单的查询操作。
- 关系代数是SQL的理论基础，需熟练掌握其符号和操作。

**实践与启示：**
- 本次课程结束后老师布置了如何使用关系代数进行查询的作业。作业内容不难，但是使用markdown格式和使用Github对当时的我来说，是提交第一次作业时最大的困难。因此为了按要求提交第一次作业，我一周内掌握了好多技能（虽然好像没什么值得骄傲的，但对我这种真·电脑白痴来说，当把作业01的Github链接写入学习通时，我觉得自己太6了，喵）。
- 在本课程中常用的各种关系如instructor、student、course、section等等都在本节中学习到。当时初学这里的时候对它的内容并不熟悉，可是再一次次回顾与应用中，对这个表的内容也有了越来越清晰的记忆与理解。

---

##**第三周（3月13日）：SQL基础 (Introduction to SQL)**
**学习内容：**
1. **SQL的历史与方言**：不同数据库系统的SQL实现差异。
2. **基本数据类型**：数值（`int` `numeric(p,d)` `float(n)`等）、字符串（`varchar(n)` `text` `char(n)`）、null。
3.**DDL（数据定义语言）**：`CREATE TABLE`、`DROP TABLE`、`ALTER TABLE`。
4. **DML（数据操作语言）**：`SELECT`（`UPDATE`、`DELETE`、`INSERT`为后续课程内容）。
5.**基本的SQL查询**：包括三个字句`SELECT`、`FROM`、`WHERE`。可以理解为先FROM，再WHERE，最后SELECT。
6. **附加SQL操作**：更名（`AS`），所有的属性（`*`），排序（`ORDER BY`）。

**实践与收获：**
- 学会了创建和修改表结构。如作业02中的：
```
CREATE TABLE users (  
     name          varchar(16)   primary key,  
     pswd          varchar(16),  
     gender        char(1)  
);
```
这些内容是完成后续数据库实践的基础，所以一定得熟练掌握。
- 掌握了基本的SQL查询语法，能够编写简单的单表和多表查询。
- 此前已完成PG和DataGrip的安装和调试（前文有描述），为下周的实验课做了足够的准备。

---

## **第四周（3月20日）：实验课01**
**主要内容：**
1. **环境搭建**：PostgreSQL安装、数据库创建（`createdb`）、DataGrip连接配置。
2. **数据导入**：执行DDL脚本（`DDL.sql`）和插入数据（`smallRelationsInsertFile.sql`）。
3. **SQL实践**：基本查询、字符串操作（`lower`、`trim`等）。
4. **模糊查询与转义**：`%`和`_`通配符的使用，用转义字符（`\`）处理特殊字符，字符串拼接（`||`）。

**实践与收获：**
- **第一次学会使用DataGrip和PG来配置数据库环境并导入数据**。
在完成实践作业时遇到了起步的问题，求助了助教也很快得到了解决，发现是自己在跟着流程操作时漏了关键一步，说明当时课堂上看似听懂了，等到操作时依然是无头苍蝇。但是真正完成作业03之后，真的觉得成就感满满。
![截图01](https://github.com/user-attachments/assets/d8f5a5d9-455b-40bf-a957-d82d3c195ced)
![截图02](https://github.com/user-attachments/assets/d94958e9-adcd-44a7-b97a-e6174459fd36)
![截图03](https://github.com/user-attachments/assets/b26e4619-1f2c-4288-9572-4e6f3623eeca)

**注意事项：**
- 字符串在SQL标准（如PG）中区分大小写。
- 模糊查询需注意通配符含义。
- 不同DBMS的语法差异（如字符串拼接符）。
- 独立完成SQL编写是一个看起来简单但对于数据库初学者来说很难起步的工作，因此编写SQL语句一定不能急于求成或者急于知道答案，一定要自己尝试先写，错也没关系，通过一遍遍巩固基础语法，不断强化理解，才能得到质的进步，真正学会编写语句。

---

## **第五周（3月27日）：空值与聚合查询 (Null and Aggregate Queries)**
**学习内容：**
1. **空值（NULL）的处理**：
   - 空值的算术运算结果仍为空值。
- 空值与数字的比较结果为`UNKNOWN`（但在DataGrip中其显示为`null`）。
   - 使用`IS NULL`或`IS NOT NULL`等测试空值。
2. **聚集函数**：`MAX`、`MIN`、`AVG`、`COUNT`、`SUM`。
3. **分组聚集**：`GROUP BY`与`HAVING`。
4. **嵌套子查询**：`IN`、`EXISTS`、`> SOME`、`> ALL`。
5. **高级查询**：`WITH`子句（临时关系）。

**学习收获：**
- 理解了空值的特殊性及其在查询中的表现。
- 掌握了聚集函数的使用场景和分组查询的多种写法，能判别一些SQL语句是否合法。
- 学会了通过子查询实现复杂条件过滤。

**注意事项：**
- 聚集函数忽略NULL，除了`COUNT(*)`考虑NULL。并且仅`COUNT`能与`*`连用。
- `COUNT(distinct *)`是不合法的。
- 聚集函数不能出现在`WHERE`行。
- `HAVING`用于分组后过滤，而`WHERE`子句中的谓词是在聚集之前起作用。
- 出现在SELECT和HAVING子句中但没有被聚集的属性只能是出现在group by子句中的那些属性。

---

## **第六周（4月3日）：修改数据库 (Change Databases)**
**学习内容：**
1. **数据操作**：
   - 插入数据：`INSERT INTO`（插入元祖集合或其他查询的结果）。
   - 删除数据：`DELETE FROM`（条件删除或清空表）。
   - 更新数据：`UPDATE`与`CASE`结合。
2. **DDL扩展**：
   - 修改表结构：`ALTER TABLE`（新增属性（`add column A D`）、删除属性（`drop column A`）、修改数据类型/属性名/关系名）。
   - 约束管理：`UNIQUE`、`CHECK`。
3. **SQL排名**： `RANK()`排名函数。

**学习收获：**
- 学会了增删改数据的SQL语句。
- 掌握了表结构的修改方法和约束的添加。
- 理解了外码的级联操作对数据一致性的影响。

**注意事项：**
- 生产环境中慎用`DELETE`，通常通过标记实现“软删除”。
- 外码约束需注意引用完整性，避免误删被引用的数据。
- `primary key`大致相当于`not null`加上`unique`。
- `check`需满足的条件时`not false`。因此，允许出现`null`，即`unknown`。

---

## **第七周（4月10日）：连接与中级SQL (Joins and Intermediate SQL)**
**学习内容：**
1. **连接类型**：
   - 自然连接（`NATURAL JOIN`）表示考虑所有相同名称属性上的相等并保留其一。
   - 内连接（`INNER JOIN`）、外连接（`LEFT/RIGHT/FULL JOIN`）。
   - `JOIN`使用`ON`或`USING`指定连接条件。
2. **视图（View）**：虚拟的表的定义与使用（`CREATE VIEW`）。
3. **完整性约束（续）**：`PRIMARY KEY`、`FOREIGN KEY`、`NOT NULL`、`CHECK`、`UNIQUE`。

**实践与收获：**
- 掌握了多种连接方式的区别和应用场景。
- 在本次作业（作业05）中，我真正实践并学会了从零开始在PostgreSQL里创建一个数据库，然后在其中创建一个表，并从TXT文件导入数据及将数据导出到CSV文件，以及后续对表中的内容进行增删改查等等系列操作。真正实操时才会发现有很多听课时没注意到的细节与问题，往往可能会导致报错或者查询结果有误。一次次的发现问题并完善的过程，是这门课程于我最大的收获。
![截图04](https://github.com/user-attachments/assets/95b13f64-eeed-4e4a-92b7-11c78772d79f)

**注意事项：**
- 自然连接会自动匹配同名属性，需警惕不必要的属性匹配，同时要注意using后面必须加括号（即使只有一个属性）。
- 外连接保留未匹配的元组（填充NULL），内连接则过滤掉未匹配的元组，默认的连接是内连接。

---

## **第8周（4月17日）：实验课02（课堂小测试）**
**实践内容：**
本次实验课测试围绕**大学数据库**和**员工奖金系统**两个场景，重点考察了以下知识点：
1. **多表连接查询**  
   - **内连接（JOIN）**：第1.1题要求仅统计授课教师的信息。  
   - **外连接（LEFT JOIN）**：第1.2题需包含未授课教师（使用`LEFT JOIN`确保左表全保留）。  
   - **自然连接（NATURAL JOIN）与 USING**：第1.4题分析自然连接的影响，第1.5题用`USING`简化相同属性连接。
2. **标量子查询（Scalar Subquery）**  
   - 第1.3题要求用子查询统计每位教师的授课数量，需注意子查询与主查询的关联条件（`i.ID = t.ID`）。
3. **分组与聚合函数**  
   - `GROUP BY`与`HAVING`过滤分组。
4. **数据建模与复杂计算**  
   - 应用题需创建`emp`和`emp_bonus`表，并通过`CASE`语句实现动态奖金计算（不同类型对应不同比例）。
5. **关系模式设计与外键约束**  
   - 应用题中`emp_bonus`表的`emp_no`需引用`emp`表的主键（`REFERENCES`）。

**学习收获与启示：**
1. **SQL 查询的灵活性与优化**  
   - 掌握了不同连接方式的适用场景：  
     - **内连接**用于精确匹配，**外连接**确保数据完整性。  
     - `USING`可替代`NATURAL JOIN`，避免隐式匹配同名属性的风险。  
   - 标量子查询适合单值结果的嵌套查询。
2. **实际问题分析与拆解能力**  
   - 应用题要求将业务逻辑（奖金类型与工资比例）转化为SQL的`CASE`语句，通过实践强化了我将实际需求转换为代码语言的映射能力。虽然这个作业我完成得很慢，快到下课前几分钟才匆匆提交了PDF版本，而且也有一定的瑕疵，但是能独立完成到这个程度我已经很佩服自己了哈哈哈哈。
3. **明确数据完整性的重要性**  
   - 通过外键约束（`REFERENCES`）确保`emp_bonus`表的数据有效性。

---

## **第9周（4月24日）：高级SQL（1）**
**学习内容：**
1. **高级数据类型**：日期和时间类型（`date`、`time`、`timestamp`、`interval`）及其操作，如可以使用`serial`实现ID等的自增。
2. **类型转换**：`CAST(e as t)`函数、`to_xxx()`方法（如`to_date`）。
3. **授权与角色管理**：`GRANT<权限列表> ON<关系或视图> TO<用户或角色>`、角色（`CREATE ROLE`）的创建与管理。
4. **数据备份与恢复**：`pg_dump`和`pg_restore`的使用。

**学习收获：**
- 掌握了日期和时间的存储与计算，例如`current_date`、`interval`和时间差计算等。
- 理解了类型转换的重要性，能够灵活使用`CAST`和`to_xxx()`等函数。
- 学会了通过`GRANT`和`CREATE ROLE`实现数据库权限控制。

**注意事项：**
- 日期和时间的默认精度（如`timestamp`秒的小数位）很多时候并不准确，需要注意。
- 关于浮点数精度问题，对精度有要求时建议使用`numeric`类型。

---

## **第10周（5月1日）：五一假期无课**
- 感恩老师没留作业喵，五一咱们也是狠狠放假了。

---

## **第11周（5月8日）：高级 SQL（2）与实验课03**
**学习内容：**
1. **函数与过程**：定义函数（`CREATE FUNCTION`）和定义过程（`CREATE PROCEDURE`）的编写与调用。
2. **触发器**：触发器的定义与使用场景（如自动更新学分）。
3. **使用程序访问数据库**：Python中访问PostgreSQL常用的驱动是psycopg2。
4. **SQL注入攻击**：拼接SQL的风险及防范措施。

**注意事项：**
- 函数返回结果，而过程主要用来执行一些操作。函数和过程的语法因DBMS而异，需查阅文档。
- 使用简单的字符串拼接构造的SQL语句有SQL注入的风险，可以使用ORM或PreparedStatement避免这个问题。

**实践课与作业收获：**
- 学习Python与数据库交互的基本方法。实验课03的课堂操作内容是学会使用Python访问数据库。但是这里的实操实在是太难了，而且上课的时候老师讲的有点快，我只创建并激活了虚拟环境之后就无从下手了，而且可能iOS和Windows还有点区别吧，看着看着就晕了，后面好多操作也是在照葫芦画瓢地乱搞，但是总之都是疯狂地报错。
- 这节实践课既讲了内容又做了实践，但只留下了一张前半部分的截图（主要原因是后面配置Python的过程中心态完全崩了，因为我从一开始创建虚拟环境就不成功，甚至删除了原来的Python并重新下载，然而我的两个系统分别都有Python，还产生了bug之类的，总之就是一团乱，搞了半天才创建了虚拟环境。所以我印象里这节实践课我要么是处理电脑，要么是飞速地跟着老师的演示操作，超级崩溃，而且好像最后也没完全成功，唉，小白的本质又再次一览无遗。）
![截图05](https://github.com/user-attachments/assets/3cdb94c6-89a3-4151-95f5-265ca4b23926)
- 这周的作业07内容比较有意思，是安装一个非关系型数据库，并完成简单的增删改查操作。经过我对多个非关系型数据库的安装配置方法的查询，还是安装Redis看起来比较好上手。因此我参考了网络上的很多教程，成功下载并安装好了Redis，学会了配置并启动Redis的服务。这个过程中有一个**需要注意的点**是，要打开Redis客户端进行连接时，需要另起一个cmd窗口到Redis目录下执行命令（见截图），而不能关闭原来Redis的启动窗口，不然就无法访问客户端了。在作业07中，我也把Redis中五种不同的数据类型：字符串（`string`）、哈希（`hash`）、列表（`list`）、无序集合（`set`）、有序集合（`zset`）对应的不同增删改查等操作命令进行了总结罗列归纳与实践操作并截图【详见作业07，此处不进行赘述，总之这个作业我很认真，且自认为完成度很高喵，为自己打call】。
![截图06](https://github.com/user-attachments/assets/2bab2d38-ded3-487b-8942-eca772e10590)

---

## **第12周（5月15日）：ER模型**
**学习内容：**
1. **数据库设计阶段**：需求分析、概念设计、逻辑设计、物理设计。
2. **E-R模型核心概念**：实体与实体集、联系与联系集、E-R图概念、属性（简单/复合/单值/多值/派生）、映射基数（1:1, 1:N, M:N）。
3. **E-R图绘制**：实体（矩形）、联系（菱形）、属性的表示方法。
4. **模式转化与优化**：E-R图转为关系模式，消除冗余属性。

**学习收获：**
- 掌握了通过E-R模型抽象现实世界需求的方法。
- 理解了弱实体集（如`section`依赖`course`）的主码构成。
- 学会了关系模式与E-R图的相互转化，学会了绘制E-R图。
- 工具推荐：Draw.io在线网站可以用于绘制E-R图，同时DataGrip可以在软件内实现可视化。在作业08中就有E-R图绘制的内容，用的就是Draw.io，操作很方便，但可能由于是初学者，感觉用着稍微有点不习惯，画得有点丑sorry。

**注意事项：**
- 派生属性（如`age`）可通过计算获得，无需存储。
- 弱实体集的主码需包含依赖实体集的主码。弱实体集的主码由标识实体机的主码加上该弱实体集的分辨符构成。
- 连接弱实体集与其依赖的强实体集的联系集的模式是冗余的。
- `Many-to-one`的联系可以让联系和`Many`一侧的实体合并。

---

## **第13周（5月22日）：关系数据库范式**
**学习内容：**
1. **范式理论**：1NF（属性原子性）、BCNF（消除非平凡依赖冗余）、3NF（允许传递依赖）。规范化的最终目标是：没有不必要的冗余，同时又能轻易地检索数据。
2. **函数依赖**：平凡依赖、闭包计算、无损分解条件、依赖保持。
3. **BCNF范式**：具有函数依赖集F的关系模式R属于BCNF的条件是，对所有F的闭包中形如X→Y，则下面的两个条件至少有一个成立：
- X→Y是平凡的函数依赖
- X是R的一个超码。
4.**BCNF分解算法**：通过非平凡依赖逐步分解模式。
5. **依赖保持性**：BCNF与依赖保持可能无法同时实现，这时可以在BCNF和3NF之间权衡。

**学习收获：**
- 理解了1NF是关系模式的基本要求，BCNF和3NF用于消除冗余。
- 能够通过函数依赖判断模式是否满足BCNF，并进行分解。在作业08中也分别进行了判断并证明模式是否满足BCNF，以及根据给定的函数依赖给出一个满足BCNF的分解，并说明该分解符合BCNF。通过作业08，我对这部分听起来弯弯绕绕容易搞混的知识进行了更深入的理解和实际应用，可以说作业08依然是一次看起来有点难但是完成后收获满满、受益匪浅的作业。

**注意事项：**
- 分解后需验证是否为无损分解。
- 实际设计中需在BCNF和3NF间权衡。
- 更高范式（4NF、5NF等）很少被使用。

---

## **第14周（5月29日）：数据库存储与索引**
**学习内容：**
1.**数据库存储**：
- 存储层级体系：从CPU寄存器到HDD的多级存储结构及其性能差异。
- Page的组织方式：堆文件、顺序文件、树文件和哈希文件组织。
- 变长数据存储：分页的槽结构(Slotted Pages)实现原理。
- 存储模型：行存储（一个元组的所有属性）、列存储（所有元组的单个属性）。
2.**索引技术**：
- 索引类型：有序索引(聚集/非聚集)与哈希索引的特点与适用场景。
- B+树索引：结构特性、平衡原理及性能优势。
- 实际应用：PostgreSQL中的索引实现与使用分析。

**学习收获：**
- 掌握了数据库底层存储机制，理解了Page的组织形式和变长数据存储方案。
- 能够区分不同索引类型的特点，并根据查询需求选择合适的索引策略。
- 了解了B+树索引的结构优势。

**注意事项：**
1. **索引设计**：
   - 聚集索引每个表只能有一个，主键选择至关重要。
   - 索引会降低写入性能，需根据实际查询模式谨慎添加。
2. **存储优化**：
   - 变长字段会带来额外的存储管理开销。
   - 大对象(BLOB/CLOB)存储受Page大小限制。
3. **实践建议**：
   - 可以在测试环境中创建不同索引并比较查询性能差异。
   - 通过实际案例理解B+树索引在不同数据量下的表现特征。

---

## **第15、16周（6月5日、6月12日）：数据库查询与事务**
**学习内容：**
1.**查询处理**：
- 查询执行三阶段：解析→优化→执行。
- 查询优化技术：谓词下推(predicate pushdown)等优化策略。
2.**事务管理**：
- ACID特性详解：原子性、一致性、隔离性、持久性。
- 事务隔离级别：从Read Uncommitted到Serializable的四种级别。
- 并发问题：脏读、不可重复读、幻读现象及产生条件。

**学习收获：**
- 能够分析不同查询计划的优劣，理解谓词下推的优化原理。
- 深入理解了事务的ACID特性及其实现意义。
- 能够区分不同隔离级别下可能出现的并发问题。
- 认识到事务隔离级别需要在性能和数据一致性之间权衡。

**注意事项：**
- 默认隔离级别(通常为Read Committed)可能不满足所有业务需求。
- 高隔离级别(如Serializable)会显著影响并发性能。
- 要根据业务需求谨慎选择事务隔离级别，金融等关键系统通常需要更高隔离级别。

---

- 总而言之，这一学期以来，我很认真对待这门课程，虽然可能产出的水平还不够好，但是我能认真对待每节理论课，每节实践课，每次课后作业，让自己的实践水平和对数据库的认知都大大提升了一个台阶。每节理论课我都会坐在靠前位置，跟着老师的思路一点点学习（虽然听不懂的时候我也没有勇气当堂提问），实验课的时候我更是三次课全部坐在中间第一排（虽然即使这样我也没能完全完美地操作）。我是个很有兴趣听课的人，不管是什么课，因为我知道任何一位老师能站在讲台上，就说明我一定有太多可以从ta身上学习的东西。一学期的学习下来，我从需要题题依赖AI，处处求助互联网和助教的数据库白痴，到学会了自己独立写一段SQL语句，掌握了DataGrip和PostgreSQL的入门用法，学会了用AI检查与反思而非直接解答。
- 在这一段学习时光里，非常感谢讲解透彻、寓教于乐的陈老师，倾囊相授、耐心解答的助教曾学长，以及其他热心同学的帮助与指点，也要感谢虽然有时候会抽风但是不辞辛劳的百度、Deepseek、DataGrip、PostgreSQL、Python、Github、PyCharm以及我的小电脑等等对我数据库课程学习的支持，当然也要感谢认真的我自己~嘻嘻。

---
